<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../../source/coffee/caim/navigation/types/ScrollNavigationController.coffee - Caim Framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://slikland.com/media/images/logo_docs.png" title="Caim Framework"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 3.3.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/_.html">_</a></li>
                                <li><a href="../classes/AnimationTicker.html">AnimationTicker</a></li>
                                <li><a href="../classes/API.html">API</a></li>
                                <li><a href="../classes/App.html">App</a></li>
                                <li><a href="../classes/ArrayUtils.html">ArrayUtils</a></li>
                                <li><a href="../classes/AssetLoader.html">AssetLoader</a></li>
                                <li><a href="../classes/BaseAnimation.html">BaseAnimation</a></li>
                                <li><a href="../classes/BaseDOM.html">BaseDOM</a></li>
                                <li><a href="../classes/BaseNavigationController.html">BaseNavigationController</a></li>
                                <li><a href="../classes/BaseView.html">BaseView</a></li>
                                <li><a href="../classes/Caim.html">Caim</a></li>
                                <li><a href="../classes/ColorUtils.html">ColorUtils</a></li>
                                <li><a href="../classes/ConditionsValidation.html">ConditionsValidation</a></li>
                                <li><a href="../classes/CookiesManager.html">CookiesManager</a></li>
                                <li><a href="../classes/DataStorageManager.html">DataStorageManager</a></li>
                                <li><a href="../classes/Debug.html">Debug</a></li>
                                <li><a href="../classes/DefaultNavigationController.html">DefaultNavigationController</a></li>
                                <li><a href="../classes/Detections.html">Detections</a></li>
                                <li><a href="../classes/DOMUtils.html">DOMUtils</a></li>
                                <li><a href="../classes/EventDispatcher.html">EventDispatcher</a></li>
                                <li><a href="../classes/FunctionUtils.html">FunctionUtils</a></li>
                                <li><a href="../classes/GeolocationDetection.html">GeolocationDetection</a></li>
                                <li><a href="../classes/GestureUtils.html">GestureUtils</a></li>
                                <li><a href="../classes/GoogleAnalytics.html">GoogleAnalytics</a></li>
                                <li><a href="../classes/GTM.html">GTM</a></li>
                                <li><a href="../classes/IndexedDB.html">IndexedDB</a></li>
                                <li><a href="../classes/JSONUtils.html">JSONUtils</a></li>
                                <li><a href="../classes/KTween.html">KTween</a></li>
                                <li><a href="../classes/MathUtils.html">MathUtils</a></li>
                                <li><a href="../classes/MediaDOM.html">MediaDOM</a></li>
                                <li><a href="../classes/MetaController.html">MetaController</a></li>
                                <li><a href="../classes/MouseUtils.html">MouseUtils</a></li>
                                <li><a href="../classes/MovieTrackingParser.html">MovieTrackingParser</a></li>
                                <li><a href="../classes/Navigation.html">Navigation</a></li>
                                <li><a href="../classes/NavigationContainer.html">NavigationContainer</a></li>
                                <li><a href="../classes/NavigationLoader.html">NavigationLoader</a></li>
                                <li><a href="../classes/NavigationRouter.html">NavigationRouter</a></li>
                                <li><a href="../classes/NumberUtils.html">NumberUtils</a></li>
                                <li><a href="../classes/ObjectUtils.html">ObjectUtils</a></li>
                                <li><a href="../classes/PreloadFiles.html">PreloadFiles</a></li>
                                <li><a href="../classes/Resizer.html">Resizer</a></li>
                                <li><a href="../classes/ResizeUtils.html">ResizeUtils</a></li>
                                <li><a href="../classes/ScrollNavigationController.html">ScrollNavigationController</a></li>
                                <li><a href="../classes/ScrollUtils.html">ScrollUtils</a></li>
                                <li><a href="../classes/ShareUtils.html">ShareUtils</a></li>
                                <li><a href="../classes/Shortcut.html">Shortcut</a></li>
                                <li><a href="../classes/SplitTextUtils.html">SplitTextUtils</a></li>
                                <li><a href="../classes/SpriteSheetAnimation.html">SpriteSheetAnimation</a></li>
                                <li><a href="../classes/SRTParser.html">SRTParser</a></li>
                                <li><a href="../classes/StringUtils.html">StringUtils</a></li>
                                <li><a href="../classes/SunUtils.html">SunUtils</a></li>
                                <li><a href="../classes/Tracking.html">Tracking</a></li>
                                <li><a href="../classes/URLUtils.html">URLUtils</a></li>
                                <li><a href="../classes/VideoCanvas.html">VideoCanvas</a></li>
                                <li><a href="../classes/VideoSubtitle.html">VideoSubtitle</a></li>
                                <li><a href="../classes/ViewsData.html">ViewsData</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/caim.html">caim</a></li>
                                <li><a href="../modules/caim.anim.html">caim.anim</a></li>
                                <li><a href="../modules/caim.data.html">caim.data</a></li>
                                <li><a href="../modules/caim.debug.html">caim.debug</a></li>
                                <li><a href="../modules/caim.event.html">caim.event</a></li>
                                <li><a href="../modules/caim.loader.html">caim.loader</a></li>
                                <li><a href="../modules/caim.media.html">caim.media</a></li>
                                <li><a href="../modules/caim.media.subtitles.html">caim.media.subtitles</a></li>
                                <li><a href="../modules/caim.media.tracking.html">caim.media.tracking</a></li>
                                <li><a href="../modules/caim.media.video.html">caim.media.video</a></li>
                                <li><a href="../modules/caim.navigation.core.html">caim.navigation.core</a></li>
                                <li><a href="../modules/caim.navigation.display.html">caim.navigation.display</a></li>
                                <li><a href="../modules/caim.navigation.types.html">caim.navigation.types</a></li>
                                <li><a href="../modules/caim.net.html">caim.net</a></li>
                                <li><a href="../modules/caim.tracking.html">caim.tracking</a></li>
                                <li><a href="../modules/caim.utils.html">caim.utils</a></li>
                                <li><a href="../modules/caim.utils.keyboard.html">caim.utils.keyboard</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../../source/coffee/caim/navigation/types/ScrollNavigationController.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
#import caim.navigation.core.BaseNavigationController
#import caim.utils.ArrayUtils

###*
@class ScrollNavigationController
@extends BaseNavigationController
@submodule caim.navigation.types
###
class ScrollNavigationController extends BaseNavigationController
	@SCROLL: &#x27;navigation_controller_scroll&#x27;

	viewScrollPercent = 0

	constructor: () -&gt;
		super

	@get type:-&gt;
		return &#x27;scroll&#x27;

	@get visibleViews:-&gt;
		return @_visibleViews

	@get currentView:-&gt;
		return @_currentView

	@get previousView:-&gt;
		return @_previousView

	@get data:()-&gt;
		return {currentView:@currentView, previousView:@previousView, visibleViews:@_visibleViews}

	start:(p_id=null)-&gt;
		if app.config.navigation.options?
			@_options = app.config.navigation.options
		else
			throw new Error(&#x27;The options object in config.json file must be created to use this navigation type, see a example in source code.&#x27;)
			###
			&quot;navigation&quot;:{
				&quot;type&quot;:&quot;scroll&quot;,
				&quot;options&quot;:{
					&quot;orientation&quot;:&quot;vertical&quot;,
					&quot;scrollToTime&quot;:0,
					&quot;pauseInvisibleViews&quot;:true,
					&quot;percentToShow&quot;:0.5,
					&quot;snap&quot;:{
						&quot;delay&quot;:0
					}
				}
			}
			###

		@_visibleViews = @_visibleViews || []
		@_autoScrolling = false

		@_orientation = if @_options.orientation? &amp;&amp; (@_options.orientation == &#x27;vertical&#x27; || @_options.orientation == &#x27;horizontal&#x27;) then @_options.orientation else &#x27;vertical&#x27;
		@_snapDelay = if @_options.snap?.delay? &amp;&amp; @_options.snap.delay &gt; 0 then @_options.snap.delay else 0
		@_scrollToTime = if @_options.scrollToTime &gt;= 0 then @_options.scrollToTime else .5
		@_percentToShow = if @_options.percentToShow &gt;= 0 || @_options.percentToShow &lt;= 1 then @_options.percentToShow else .5
		@_pauseInvisibleViews = if @_options.pauseInvisibleViews? then @_options.pauseInvisibleViews else true

		for k, v of app.config.views
			view = @_views.create(k)
			view.data.snap ?= true
			@_appendToWrapper(view)
			view.createStart()
		
		window.addEventListener &quot;scroll&quot;, @_onScroll
		@_onScroll(null)
		
		super(p_id)

	change:(p_id)=&gt;
		# returns if target view is the same
		if @_currentView?.id is p_id then return
		if @_currentView? then @_previousView = @_currentView
		@_currentView = @_views.create(p_id)

		@_scrollToView(p_id)
	
	_onScroll:(evt)=&gt;
		@_visibleViews = @_visibleViews || []
		currentView = null

		for k, v of app.config.views
			view = @_views.create(k)
			
			if @_orientation == &#x27;vertical&#x27;
				viewOffset = (view.height + view.element.offsetTop)
			else
				viewOffset = (view.width + view.element.offsetLeft)

			viewBounds = viewOffset - @scrollValue

			if @_isVisible(view)
				if @_visibleViews.indexOf(view) &lt; 0 then @_visibleViews.push view
			else
				index = @_visibleViews.indexOf(view)
				if index &gt;= 0 then ArrayUtils.removeItemByIndex(index, @_visibleViews)
			
			# TODO: add option of percentToShow for each view 
			# percentToShow = if view.percentToShow? then view.percentToShow else @_percentToShow
			if viewBounds &gt; (@windowValue*@_percentToShow) and currentView == null
				currentView = view
				@_snapping(view)

				if @_currentView?.id is view.id then continue
				if @_currentView? then @_previousView = @_currentView
				@_currentView = @_views.create(view.id)

				@_show(view)
			else
				@_hide(view)
		@trigger(ScrollNavigationController.SCROLL, {percent:@scrollPercent, value:@scrollValue})
		
	_isVisible:(p_view)=&gt;
		if @_orientation == &#x27;vertical&#x27;
			elementTop = p_view.element.offsetTop
			elementBottom = elementTop + p_view.height
			return (@scrollValue + window.innerHeight) &gt; elementTop &amp;&amp; @scrollValue + window.innerHeight &lt; (elementBottom + window.innerHeight)
		else
			elementLeft = p_view.element.offsetLeft
			elementRight = elementLeft + p_view.width
			return (@scrollValue + window.innerWidth) &gt; elementLeft &amp;&amp; @scrollValue + window.innerWidth &lt; (elementRight + window.innerWidth)

	_snapping:(p_view)=&gt;
		if !@_autoScrolling &amp;&amp; @_snapDelay&gt; 0
			TweenMax.killDelayedCallsTo @_scrollToView

			if p_view.data.snap || p_view.snap
				TweenMax.delayedCall @_snapDelay, @_scrollToView, [p_view.id]

	_show:(p_view)=&gt;
		@trigger(BaseNavigationController.CHANGE_VIEW, {data:@data})
		if !p_view.showed
			p_view.showStart()
		else
			if @_pauseInvisibleViews then p_view.resume()

	_hide:(p_view)=&gt;
		if !@_isVisible(p_view)
			if @_pauseInvisibleViews then p_view.pause()
		
		if p_view.id != @_currentView.id
			if p_view.showed
				p_view.hideStart()

	_scrollToView:(p_id)=&gt;
		view = @_views.create(p_id)

		TweenMax.killDelayedCallsTo @_scrollToView
		TweenMax.killTweensOf window
		
		if @_orientation == &#x27;vertical&#x27;
			orientation = {
				y:view.element.offsetTop,
				onAutoKill:@_onAutoKill
			}
		else
			orientation = {
				x:view.element.offsetLeft,
				onAutoKill:@_onAutoKill
			}

		TweenMax.to window, @_scrollToTime, {
			scrollTo:orientation, 
			ease:Quad.easeOut, 
			onStart:@_onStartAutoScroll, 
			onComplete:@_onCompleteAutoScroll,
			onCompleteParams:[view]
		}

	_onStartAutoScroll:()=&gt;
		@_autoScrolling = true
	
	_onCompleteAutoScroll:(p_view)=&gt;
		@_autoScrolling = false
		@_show(p_view)

	_onAutoKill:(evt)=&gt;
		@_autoScrolling = false

	@get scrollPercent:()-&gt;
		body = document.body
		doc = document.documentElement
		if @_orientation == &#x27;vertical&#x27;
			return ((doc.scrollTop + body.scrollTop) / (doc.scrollHeight - doc.clientHeight))
		else
			return ((doc.scrollLeft + body.scrollLeft) / (doc.scrollWidth - doc.clientWidth))

	@get scrollValue:-&gt;
		body = document.body
		doc = document.documentElement
		if @_orientation == &#x27;vertical&#x27;
			if typeof pageYOffset != &#x27;undefined&#x27;
				return pageYOffset
			else
				doc = if doc.clientHeight then doc else body
				return doc.scrollTop
		else
			if typeof pageXOffset != &#x27;undefined&#x27;
				return pageXOffset
			else
				doc = if doc.clientWidth then doc else body
				return doc.scrollLeft
	
	@get windowValue:-&gt;
		return if @_orientation == &#x27;vertical&#x27; then window.innerHeight else window.innerWidth


    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
