<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../../source/coffee/slikland/navigation/core/Caim.coffee - Slikland Framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://slikland.com/media/images/logo_docs.png" title="Slikland Framework"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AnimationTicker.html">AnimationTicker</a></li>
                                <li><a href="../classes/ArrayUtils.html">ArrayUtils</a></li>
                                <li><a href="../classes/BaseAnimation.html">BaseAnimation</a></li>
                                <li><a href="../classes/BaseDOM.html">BaseDOM</a></li>
                                <li><a href="../classes/BaseNavigationController.html">BaseNavigationController</a></li>
                                <li><a href="../classes/BaseView.html">BaseView</a></li>
                                <li><a href="../classes/Caim.html">Caim</a></li>
                                <li><a href="../classes/ColorUtils.html">ColorUtils</a></li>
                                <li><a href="../classes/ConditionsValidation.html">ConditionsValidation</a></li>
                                <li><a href="../classes/Debug.html">Debug</a></li>
                                <li><a href="../classes/Detections.html">Detections</a></li>
                                <li><a href="../classes/EventDispatcher.html">EventDispatcher</a></li>
                                <li><a href="../classes/MetaController.html">MetaController</a></li>
                                <li><a href="../classes/Navigation.html">Navigation</a></li>
                                <li><a href="../classes/NavigationContainer.html">NavigationContainer</a></li>
                                <li><a href="../classes/NavigationLoader.html">NavigationLoader</a></li>
                                <li><a href="../classes/NavigationRouter.html">NavigationRouter</a></li>
                                <li><a href="../classes/PreloadFiles.html">PreloadFiles</a></li>
                                <li><a href="../classes/Prototypes.html">Prototypes</a></li>
                                <li><a href="../classes/SpriteSheetAnimation.html">SpriteSheetAnimation</a></li>
                                <li><a href="../classes/StringUtils.html">StringUtils</a></li>
                                <li><a href="../classes/ViewsData.html">ViewsData</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../../source/coffee/slikland/navigation/core/Caim.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
#import slikland.event.EventDispatcher

#import slikland.navigation.core.App
#import slikland.debug.Debug
#import slikland.utils.Prototypes

#import slikland.utils.ArrayUtils
#import slikland.utils.ObjectUtils
#import slikland.utils.StringUtils
#import slikland.utils.JSONUtils
#import slikland.utils.Detections

#import slikland.loader.AssetLoader
#import slikland.navigation.core.data.ConditionsValidation
#import slikland.navigation.display.BaseView

#import slikland.navigation.core.NavigationLoader

###*
Base class to setup the navigation and start loading of dependencies.

@class Caim
@extends EventDispatcher
###
class Caim extends EventDispatcher
	
	_mainView = null
	_preloaderView = null

	wrapper = null
	
	###*
	@class Caim
	@constructor
	@param {BaseView} p_preloaderView The view of the first loading, it&#x27;s called by the method {{#crossLink &quot;Caim/createPreloaderView:method&quot;}}{{/crossLink}} and attached on container when the preloader assets is completely loaded.
	@param {String} [p_configPath = &quot;data/config.json&quot;] Path of the navigation configuration file.
	@param {HTMLElement} [p_wrapper = null] Custom container to attach the navigation.
	###
	constructor:(p_preloaderView, p_configPath=&quot;data/config.json&quot;, p_wrapper=null)-&gt;
		if !(p_preloaderView instanceof BaseView)
			throw new Error(&#x27;The param p_preloaderView is null or the instance of param p_preloaderView is not either BaseView class&#x27;)
		else
			_preloaderView = p_preloaderView 

		wrapper = if !(p_wrapper)? then document.body else p_wrapper

		app.root = document.querySelector(&quot;base&quot;)?.href || document.getElementsByTagName(&quot;base&quot;)[0]?.href
		app.loader = AssetLoader.getInstance()
		app.detections = Detections.getInstance()

		loader = new NavigationLoader(if app.root? then app.root+p_configPath else p_configPath)
		loader.on(NavigationLoader.CONFIG_LOADED, @configLoaded)
		loader.on(NavigationLoader.LOAD_START, @createPreloaderView)
		loader.on(NavigationLoader.LOAD_PROGRESS, @progress)
		loader.on(NavigationLoader.LOAD_COMPLETE, @hidePreloderView)
		loader.on(NavigationLoader.LOAD_FILE_COMPLETE, @loadFileComplete)

		loader.on(NavigationLoader.GROUP_ASSETS_LOADED, @groupLoaded)

		# @TODO
		# if window.location.href.indexOf(&#x27;preview&#x27;) is -1 and !Debug.debug
		# 	app.sw = ServiceWorkerController.getInstance().init()
		
		false
	
	###*
	@method configLoaded
	@param {Event} evt
	@private
	###
	configLoaded:(evt)=&gt;
		evt?.currentTarget?.off?(NavigationLoader.CONFIG_LOADED, @configLoaded)
		app.config = evt.data
		app.conditions = if app.config.conditions? then ConditionsValidation.getInstance(app.config.conditions) else null
		false 

	###*
	@method loadFileComplete
	@param {Event} evt
	@private
	###
	loadFileComplete:(evt)=&gt;
		data = evt.result
		if data instanceof BaseView &amp;&amp; data.id == &#x27;main&#x27;
			_mainView = data
		false

	###*
	@method progress
	@param {Event} evt
	@private
	###
	progress:(evt)=&gt;
		_preloaderView?.progress = evt.progress
		false

	###*
	@method groupLoaded
	@param {Event} evt
	@private
	###
	groupLoaded:(evt)=&gt;
		switch evt.id
			when &#x27;core&#x27;
				@coreAssetsLoaded()
				break
			when &#x27;main&#x27;
				@mainAssetsLoaded()
				break
			when &#x27;preloader&#x27;
				@preloaderAssetsLoaded()
				break

	###*
	@method createPreloaderView
	@param {Event} [evt=null]
	@protected
	###
	createPreloaderView:(evt=null)=&gt;
		evt?.currentTarget?.off?(NavigationLoader.LOAD_START, @createPreloaderView)

		wrapper.appendChild(_preloaderView.element)
		_preloaderView.on(BaseView.CREATE_COMPLETE, @showPreloaderView)
		_preloaderView.createStart()
		false
		
	###*
	@method showPreloaderView
	@param {Event} [evt=null]
	@protected
	###
	showPreloaderView:(evt=null)=&gt;
		_preloaderView.off(BaseView.CREATE_COMPLETE, @showPreloaderView)
		_preloaderView.showStart()
		false

	###*
	@method hidePreloderView
	@param {Event} [evt=null]
	@protected
	###
	hidePreloderView:(evt=null)=&gt;
		_preloaderView.on(BaseView.HIDE_COMPLETE, @destroyPreloderView)
		_preloaderView.progress = 1
		_preloaderView.hideStart()
		false

	###*
	@method destroyPreloderView
	@param {Event} [evt=null]
	@protected
	###
	destroyPreloderView:(evt=null)=&gt;
		hiddenFonts = document.getElementById(&#x27;hiddenFonts&#x27;)
		hiddenFonts?.parentNode?.removeChild(hiddenFonts)

		_preloaderView.off(BaseView.HIDE_COMPLETE, @destroyPreloderView)
		_preloaderView.on(BaseView.DESTROY_COMPLETE, @_createMainView)
		_preloaderView.destroy()
		false

	###*
	@method _createMainView
	@private
	###
	_createMainView:()=&gt;
		_preloaderView.off(BaseView.DESTROY_COMPLETE, @_createMainView)
		wrapper.removeChild(_preloaderView.element)
		_preloaderView = null

		if !(_mainView instanceof BaseView) then throw new Error(&#x27;The instance of Main class is not either BaseView class&#x27;)

		app.container = _mainView
		wrapper.appendChild(_mainView.element)

		_mainView.on(BaseView.CREATE_COMPLETE, @_showMainView)
		if app.config.navigation?.startBefore || app.config.navigation?.startBefore is undefined
			_mainView.setupNavigation(app.config)
			_mainView.createStart()
		else
			_mainView.createStart()
			_mainView.setupNavigation(app.config)

		false
	
	###*
	@method _showMainView
	@param {Event} [evt=null]
	@private
	###
	_showMainView:(evt=null)=&gt;
		_mainView.off(BaseView.CREATE_COMPLETE, @_showMainView)
		_mainView.showStart()
		false

	###*
	Called only when the core assets is completely loaded.
	@method coreAssetsLoaded
	@param {Event} [evt=null]
	@protected
	###
	coreAssetsLoaded:(evt=null)=&gt;
		false

	###*
	Called only when the preloader assets is completely loaded.
	@method preloaderAssetsLoaded
	@param {Event} [evt=null]
	@protected
	###
	preloaderAssetsLoaded:(evt=null)=&gt;
		false

	###*
	Called only when the main assets is completely loaded.
	@method mainAssetsLoaded
	@param {Event} [evt=null]
	@protected
	###
	mainAssetsLoaded:(evt=null)=&gt;
		false

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
