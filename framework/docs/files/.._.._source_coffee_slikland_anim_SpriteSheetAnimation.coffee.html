<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../../source/coffee/slikland/anim/SpriteSheetAnimation.coffee - Slikland Framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://slikland.com/media/images/logo_docs.png" title="Slikland Framework"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AnimationTicker.html">AnimationTicker</a></li>
                                <li><a href="../classes/ArrayUtils.html">ArrayUtils</a></li>
                                <li><a href="../classes/BaseAnimation.html">BaseAnimation</a></li>
                                <li><a href="../classes/BaseDOM.html">BaseDOM</a></li>
                                <li><a href="../classes/BaseView.html">BaseView</a></li>
                                <li><a href="../classes/ColorUtils.html">ColorUtils</a></li>
                                <li><a href="../classes/Detections.html">Detections</a></li>
                                <li><a href="../classes/EventDispatcher.html">EventDispatcher</a></li>
                                <li><a href="../classes/NavigationLoader.html">NavigationLoader</a></li>
                                <li><a href="../classes/SpriteSheetAnimation.html">SpriteSheetAnimation</a></li>
                                <li><a href="../classes/StringUtils.html">StringUtils</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../../source/coffee/slikland/anim/SpriteSheetAnimation.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
#import slikland.anim.BaseAnimation
#import slikland.display.BaseDOM
class SpriteSheetAnimation extends BaseAnimation

	@_init:()-&gt;
		head = document.querySelector(&quot;head&quot;) || document.getElementsByTagName(&quot;head&quot;)[0]
		css = &#x27;.animation.spritesheet{display: inline-block;position: relative;font-size:0px;}&#x27;
		style = document.createElement(&#x27;style&#x27;)
		style.type = &quot;text/css&quot;
		head.appendChild(style)
		si = head.querySelectorAll(&#x27;style&#x27;).length

		try
			style.appendChild(document.createTextNode(css))
		catch e
			if document.all
				document.styleSheets[si].cssText = css

	@_init()
	###*
	Spritesheet Animation class

	This class will animate a spritesheet. It already handles responsiveness.&lt;br&gt;
	So If the size of the SpriteSheetAnimation div is set, the animation will fit in the defined size.&lt;br&gt;
	If a size is not set, it&#x27;ll use the size defined in the JSON object.

	@class SpriteSheetAnimation
	@constructor
	@extends BaseAnimation
	@param {Object} data Object defining spritesheet.

	The Spritesheet image and json needs to be generated by Adobe Flash.&lt;br&gt;
	It also accepts *trim* and *border* parameters set when exporting the Spritesheet from Adobe Flash.

	Name |Type|Default|Description
	-----|----|:------|-----------
	image|Image|null|Image of spritesheet. It can either be a Image Element or PreloadJS image loader, which gives *data.tag* as image.
	json|Object|null|JSON object defining the spritesheet. It can either be an Object or PreloadJS json loader, which gives *data.tag* as object.
	useBackground|Bool|false|Boolean indicating if the Spritesheet Animation should use as background-image or a image element. Default is **false**. It&#x27;s safer using an Image element instead of background-image for cross-browser integration.

	@example
	&#x60;&#x60;&#x60;
	spritesheet = new SpriteSheetAnimation({image: someImage, json: someJson});
	document.body.appendChild(spritesheet.element);
	sprithesheet.play({repeat: false});
	&#x60;&#x60;&#x60;
	###
	constructor:(data)-&gt;
		if !data.image?
			throw new Error(&#x27;data.image is not set&#x27;)
		if !(data.json)
			throw new Error(&#x27;data.json is not set&#x27;)
		image = data.image.tag || data.image
		json = data.json.tag || data.json

		if !(image instanceof Image || image.tagName?.toLowerCase() == &#x27;img&#x27;)
			throw new Error(&#x27;data.image is not Type of Image&#x27;)

		super
		@addClass(&#x27;spritesheet&#x27;)
		
		@_useBackground = data.background || false
		@_frames = @_parseJson(json)
		@_totalFrames = @_frames.length

		@_holder = new BaseDOM({element: &#x27;div&#x27;})
		@_holder.css({
			display: &#x27;inline-block&#x27;
			width: @_size.w + &#x27;px&#x27;
			height: @_size.h + &#x27;px&#x27;
		})
		@appendChild(@_holder)

		@_container = new BaseDOM({element: &#x27;div&#x27;})
		@_container.css({
			display: &#x27;inline-block&#x27;
			position: &#x27;absolute&#x27;
			overflow: &#x27;hidden&#x27;
		})
		@appendChild(@_container)

		if @_useBackground
			@_setupBackground(image)
			@_redraw = @_redrawBackground
		else
			@_setupImage(image)
			@_redraw = @_redrawImage

	_parseJson:(data)-&gt;
		frames = []
		@_imageSize = data.meta.size
		trimmed = false
		maxWidth = Number.MIN_VALUE
		maxHeight = Number.MIN_VALUE
		i = 0
		for f in data.frames
			sw = f.sourceSize.w
			sh = f.sourceSize.h
			isw = 1 / sw
			ish = 1 / sh
			fo = {}
			fo.source = f.frame
			if @_useBackground
				fo.proportionalSource = {x: ((f.frame.x / (@_imageSize.w - f.frame.w)) * 100).toString() + &#x27;%&#x27;, y: ((f.frame.y / (@_imageSize.h - f.frame.h)) * 100).toString() + &#x27;%&#x27;, w: ((@_imageSize.w / f.frame.w) * 100).toString() + &#x27;%&#x27;, h: ((@_imageSize.h / f.frame.h) * 100).toString() + &#x27;%&#x27;}
			else
				fo.proportionalSource = {x: (-(f.frame.x / f.frame.w) * 100).toString() + &#x27;%&#x27;, y: (-(f.frame.y / f.frame.h) * 100).toString() + &#x27;%&#x27;, w: ((@_imageSize.w / f.frame.w) * 100).toString() + &#x27;%&#x27;, h: ((@_imageSize.h / f.frame.h) * 100).toString() + &#x27;%&#x27;}
			fo.output = {x: f.spriteSourceSize.x, y: f.spriteSourceSize.y, w: f.frame.w, h: f.frame.h}
			fo.proportionalOutput = {x: f.spriteSourceSize.x * isw, y: f.spriteSourceSize.y * ish, w: f.frame.w * isw, h: f.frame.h * ish}
			if maxWidth &lt; sw
				maxWidth = sw
			if maxHeight &lt; sh
				maxHeight = sh
			frames[i++] = fo
		@_size = {w: maxWidth, h: maxHeight}
		i = frames.length
		while i-- &gt; 0
			fo = frames[i]
			fo.output.x = ((fo.output.x / maxWidth) * 100).toString() + &#x27;%&#x27;
			fo.output.y = ((fo.output.y / maxHeight) * 100).toString() + &#x27;%&#x27;
			fo.output.w = ((fo.output.w / maxWidth) * 100).toString() + &#x27;%&#x27;
			fo.output.h = ((fo.output.h / maxHeight) * 100).toString() + &#x27;%&#x27;
		return frames

	_setupImage:(image)-&gt;
		@_image = image.cloneNode()
		@_image.style.position = &#x27;absolute&#x27;
		@_image.style.display = &#x27;inline-block&#x27;
		@_image.style.width = (@_imageSize.w / @_size.w) * 100 + &#x27;%&#x27;
		@_image.style.height = (@_imageSize.h / @_size.h) * 100 + &#x27;%&#x27;
		@_container.appendChild(@_image)
	_setupBackground:(image)-&gt;
		@_container.css({
			&#x27;background-image&#x27;: &#x27;url(&#x27; + image.src + &#x27;)&#x27;
		})

	_redrawImage:()=&gt;
		fd = @_frames[@_currentFrame]
		if !fd
			return
		@_container.css({
			left: fd.output.x
			top: fd.output.y
			width: fd.output.w
			height: fd.output.h
		})

		@_image.style[&#x27;left&#x27;] = fd.proportionalSource.x
		@_image.style[&#x27;top&#x27;] = fd.proportionalSource.y
		@_image.style[&#x27;width&#x27;] = fd.proportionalSource.w
		@_image.style[&#x27;height&#x27;] = fd.proportionalSource.h

	_redrawBackground:()=&gt;
		fd = @_frames[@_currentFrame]
		if !fd
			return
		@_container.css({
			left: fd.output.x
			top: fd.output.y
			width: fd.output.w
			height: fd.output.h
			backgroundSize: fd.proportionalSource.w + &#x27; &#x27; + fd.proportionalSource.h
			backgroundPosition: fd.proportionalSource.x + &#x27; &#x27; + fd.proportionalSource.y
		})

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
