<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../../source/coffee/slikland/navigation/core/NavigationRouter.coffee - Caim Framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://slikland.com/media/images/logo_docs.png" title="Caim Framework"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 3.3.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AnimationTicker.html">AnimationTicker</a></li>
                                <li><a href="../classes/ArrayUtils.html">ArrayUtils</a></li>
                                <li><a href="../classes/BaseAnimation.html">BaseAnimation</a></li>
                                <li><a href="../classes/BaseDOM.html">BaseDOM</a></li>
                                <li><a href="../classes/BaseNavigationController.html">BaseNavigationController</a></li>
                                <li><a href="../classes/BaseView.html">BaseView</a></li>
                                <li><a href="../classes/Caim.html">Caim</a></li>
                                <li><a href="../classes/ColorUtils.html">ColorUtils</a></li>
                                <li><a href="../classes/ConditionsValidation.html">ConditionsValidation</a></li>
                                <li><a href="../classes/Debug.html">Debug</a></li>
                                <li><a href="../classes/Detections.html">Detections</a></li>
                                <li><a href="../classes/DOMUtils.html">DOMUtils</a></li>
                                <li><a href="../classes/EventDispatcher.html">EventDispatcher</a></li>
                                <li><a href="../classes/FunctionUtils.html">FunctionUtils</a></li>
                                <li><a href="../classes/JSONUtils.html">JSONUtils</a></li>
                                <li><a href="../classes/KTween.html">KTween</a></li>
                                <li><a href="../classes/MathUtils.html">MathUtils</a></li>
                                <li><a href="../classes/MetaController.html">MetaController</a></li>
                                <li><a href="../classes/MouseUtils.html">MouseUtils</a></li>
                                <li><a href="../classes/Navigation.html">Navigation</a></li>
                                <li><a href="../classes/NavigationContainer.html">NavigationContainer</a></li>
                                <li><a href="../classes/NavigationLoader.html">NavigationLoader</a></li>
                                <li><a href="../classes/NavigationRouter.html">NavigationRouter</a></li>
                                <li><a href="../classes/ObjectUtils.html">ObjectUtils</a></li>
                                <li><a href="../classes/PreloadFiles.html">PreloadFiles</a></li>
                                <li><a href="../classes/Prototypes.html">Prototypes</a></li>
                                <li><a href="../classes/ResizeUtils.html">ResizeUtils</a></li>
                                <li><a href="../classes/ShareUtils.html">ShareUtils</a></li>
                                <li><a href="../classes/SplitTextUtils.html">SplitTextUtils</a></li>
                                <li><a href="../classes/SpriteSheetAnimation.html">SpriteSheetAnimation</a></li>
                                <li><a href="../classes/StringUtils.html">StringUtils</a></li>
                                <li><a href="../classes/SunUtils.html">SunUtils</a></li>
                                <li><a href="../classes/TouchUtils.html">TouchUtils</a></li>
                                <li><a href="../classes/URLUtils.html">URLUtils</a></li>
                                <li><a href="../classes/ViewsData.html">ViewsData</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../../source/coffee/slikland/navigation/core/NavigationRouter.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
###*
@class NavigationRouter
@extends EventDispatcher
@final
###
class NavigationRouter extends EventDispatcher

	###*
	@event CHANGE
	@static
	###
	@CHANGE: &#x27;route_path_change&#x27;
	###*
	@event CHANGE_ROUTE
	@static
	###
	@CHANGE_ROUTE: &#x27;route_match&#x27;

	###*
	@class NavigationRouter
	@constructor
	###
	constructor:()-&gt;
		@_routes = []
		@_numRoutes = 0
		@_trigger = true
		super

	###*
	@method setup
	@param {String} [p_rootPath = null] Use root path if not set in base tag
	@param {Boolean} [p_forceHashBang = false] Force hash bang for old browsers
	@return {NavigationRouter}
	###
	setup:(p_rootPath = null, p_forceHashBang = false)-&gt;
		if !p_rootPath
			p_rootPath = window.location.href
			try
				base = document.getElementsByTagName(&#x27;base&#x27;)
				if base.length &gt; 0
					base = base[0]
					p_rootPath = base.getAttribute(&#x27;href&#x27;)
			catch err
				console.log err.stack

		@_rootPath = p_rootPath.replace(/^(.*?)\/*$/, &#x27;$1/&#x27;)
		@_rawPath = &#x27;&#x27;

		if p_forceHashBang
			@_usePushState = false
		else
			@_usePushState = window?.history?.pushState?

		if @_usePushState
			if @_rootPath != window.location.href
				path = @_getPath()
				@goto(path, false)
			if window.addEventListener
				window.addEventListener(&#x27;popstate&#x27;, @_onPathChange)
			else
				# fix to browsers that not support addEventListener
				window.attachEvent(&quot;onpopstate&quot;, @_onPathChange)
		else
			if @_rootPath != window.location.href
				path = @_getPath()
				window.location = @_rootPath + &#x27;#!/&#x27; + path
			if window.addEventListener
				window.addEventListener(&#x27;hashchange&#x27;, @_onPathChange)
			else
				# fix to browsers that not support addEventListener
				window.attachEvent(&quot;onhashchange&quot;, @_onPathChange)
		@_onPathChange()
		return @

	###*
	@method _getPath
	@return {String}
	@private
	###
	_getPath:()-&gt;
		rawPath = window.location.href.replace(/\/*$/g,&#x27;&#x27;)

		if rawPath.indexOf(@_rootPath.replace(/\/*$/g,&#x27;&#x27;)) == 0
			rawPath = rawPath.substr(@_rootPath.length)
		rawPath = rawPath.replace(/^(?:#?!?\/*)([^?]*\??.*?)$/, &#x27;$1&#x27;)
		return rawPath

	###*
	@method _parsePath
	@param {String} p_rawPath
	@return {Object}
	@private
	###
	_parsePath:(p_rawPath)-&gt;
		pathParts = /^(?:#?!?\/*)([^?]*\??.*?)$/.exec(p_rawPath)
		path = pathParts[1]
		params = @_parseParams(pathParts[2])
		return {rawPath: p_rawPath, path: path, params: params}

	###*
	@method _parseParams
	@param {String} p_path
	@return {Object}
	@private
	###
	_parseParams:(p_path)-&gt;
		params = {}
		if p_path
			pRE = /&amp;?([^=&amp;]+)=?([^=&amp;]*)/g
			c = 0
			while o = pRE.exec(p_path)
				params[o[1]] = o[2]
		return params

	###*
	@method _onPathChange
	@param {Event} [evt = null]
	@private
	###
	_onPathChange:(evt=null)=&gt;
		@_currentPath = @_getPath()
		
		if @_trigger
			@_triggerPath(@_currentPath)
		@_trigger = true
		
		if @_replaceData
			@goto(@_replaceData[0], false)
			@_replaceData = null
		else
			@trigger(NavigationRouter.CHANGE, @_parsePath(@_currentPath))
		false

	###*
	@method _triggerPath
	@param {String} p_path
	@private
	###
	_triggerPath:(p_path)-&gt;
		pathData = @_parsePath(p_path)
		[routes, routeData] = @_checkRoutes(pathData.path)
		if routes
			i = routes.length
			while i-- &gt; 0
				route = routes[i]
				@trigger(NavigationRouter.CHANGE_ROUTE, {route: route.route, routeData: routeData, path: p_path, pathData: pathData, data: route.data})
		false

	###*
	@method getCurrentPath
	@return {String}
	###
	getCurrentPath:()-&gt;
		return @_currentPath

	###*
	@method getParsedPath
	@return {Object}
	###
	getParsedPath:()-&gt;
		return @_parsePath(@_currentPath)

	###*
	@method goto
	@param {String} p_path
	@param {Boolean} [p_trigger = true]
	###
	goto:(p_path, p_trigger = true)-&gt;
		p_path = p_path.replace(/^(?:#?!?\/*)([^?]*\??.*?)$/, &#x27;$1&#x27;)
		# console.log @_getParams()
		if p_path == @_currentPath
			return
		@_currentPath = p_path
		@_trigger = p_trigger
		if @_usePushState
			history.pushState({}, p_path, @_rootPath + p_path)
			if @_trigger
				@_onPathChange()
			@_trigger = true
		else
			window.location.hash = &#x27;!&#x27; + &#x27;/&#x27; + p_path
		false
		
	###*
	@method replace
	@param {String} p_path
	@param {Boolean} [p_trigger = false]
	###
	replace:(p_path, p_trigger = false)-&gt;
		p_path = p_path.replace(/^(?:#?!?\/*)([^?]*\??.*?)$/, &#x27;$1&#x27;)
		if p_path != @_currentPath
			@_currentPath = p_path
			if @_usePushState
				history.replaceState({}, p_path, @_rootPath + p_path)
			else
				@_trigger = false
				history.back()
				@_replaceData = [p_path]
		if p_trigger
			@triggerPath(p_path)
		false

	###*
	@method triggerPath
	@param {String} p_path
	###
	triggerPath:(p_path)-&gt;
		@_triggerPath(p_path)
		false

	###*
	@method triggerCurrentPath
	@param {String} p_path
	###
	triggerCurrentPath:()-&gt;
		@_triggerPath(@_getPath())
		false

	###*
	Add a route
	@method addRoute
	@param {String} p_route
	@param {Object} [p_data = null]
	###
	addRoute:(p_route, p_data = null)-&gt;
		# console.log &quot;addRoute&quot;
		if typeof(p_route)!=&#x27;string&#x27;
			i = p_route.length
			while i-- &gt; 0
				@addRoute(p_route[i], p_data)

		r = /\{(.*?)\}/g
		labels = []
		p = 0	
		while o = r.exec(p_route)
			labels[p++] = o[1]
		r = p_route
		if r == &#x27;*&#x27; then r = &#x27;.*&#x27;

		try
			r = r.replace(/(.*?)\/*$/, &#x27;$1&#x27;)
			routeRE = new RegExp(&#x27;(?:&#x27; + r.replace(/\{.*?\}/g, &#x27;(.+?)&#x27;) + &#x27;$)&#x27;, &#x27;g&#x27;)
		catch err
			console.log err.stack
			return

		@_routes[@_numRoutes++] = {data: p_data, route: p_route, routeRE: routeRE, labels: labels, numLabels: labels.length, numSlashes: p_route.split(&#x27;/&#x27;).length}
		@_routes.sort(@_sortRoutes)
		false

	###*
	Remove a route
	@method removeRoute
	@param {String} p_route
	###
	removeRoute:(p_route)-&gt;
		i = @_numRoutes
		while i-- &gt; 0
			route = @_routes[i]
			if route.route == p_route
				@_routes.splice(i, 1)

		@_numRoutes = @_routes.length
		false

	###*
	Remove all routes
	@method removeAllRoutes
	###
	removeAllRoutes:()-&gt;
		@_routes.length = 0
		@_numRoutes = @_routes.length

	###*
	@method _checkRoutes
	@param {String} p_path
	@private
	@return {Array}
	###
	_checkRoutes:(p_path)-&gt;
		i = @_numRoutes
		foundRoute = null
		data = null
		routes = []
		routesIndex = 0
		p_path = &#x27;/&#x27; + p_path

		while i-- &gt; 0
			route = @_routes[i]
			if foundRoute
				if route.route == foundRoute
					routes[routesIndex++] = route
				else
					break
			re = route.routeRE
			re.lastIndex = 0

			# if !(o = re.exec(p_path) and route.route isnt &#x27;/&#x27; or p_path is route.route)
			if !(o = re.exec(p_path))
				continue
			data = {}
			routes[routesIndex++] = route
			foundRoute = route.route
			for label, j in route.labels
				v = o[j + 1]
				data[label] = v
		return [routes, data]

	###*
	@method _sortRoutes
	@param {String} p_a
	@param {String} p_b
	@private
	@return {Number}
	###
	_sortRoutes:(p_a, p_b)-&gt;
		if p_a.numLabels &lt; p_b.numLabels
			return -1
		if p_a.numLabels &gt; p_b.numLabels
			return 1
		if p_a.numSlashes &lt; p_b.numSlashes
			return -1
		if p_a.numSlashes &gt; p_b.numSlashes
			return 1
		if p_a.route == p_b.route
			return 0
		if p_a.route &lt; p_b.route
			return -1
		if p_a.route &gt; p_b.route
			return 1
		return 0

	_getParams:()-&gt;
		pathData = @_parsePath(@_currentPath)
		params = pathData[&#x27;params&#x27;]
		for k, v of params
			v = decodeURIComponent(v)
			try
				decoded = JSON.parse(v)
				if typeof(decoded) != &#x27;string&#x27;
					v = decoded
			params[k] = v
		return params

	_setParams:(params)-&gt;
		pathData = @_parsePath(@_currentPath)
		pArr = []
		for k, v of params
			try
				if typeof(v) != &#x27;string&#x27;
					v = JSON.stringify(v)
			pArr.push(k + &#x27;=&#x27; + encodeURIComponent(v))
			params[k] = v

		path = pathData.path
		if pArr.length &gt; 0
			path = path + &#x27;?&#x27; + pArr.join(&#x27;&amp;&#x27;)
		@replace(path)

	getParam:(name)-&gt;
		params = @_getParams()
		return params[name]

	setParam:(name, value)-&gt;
		params = @_getParams()
		params[name] = value
		@_setParams(params)

	removeParam:(name)-&gt;
		params = @_getParams()
		params[name] = null
		delete params[name]
		@_setParams(params)

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
