<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../../source/coffee/slikland/anim/BaseAnimation.coffee - Slikland Framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://slikland.com/media/images/logo_docs.png" title="Slikland Framework"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AnimationTicker.html">AnimationTicker</a></li>
                                <li><a href="../classes/ArrayUtils.html">ArrayUtils</a></li>
                                <li><a href="../classes/BaseAnimation.html">BaseAnimation</a></li>
                                <li><a href="../classes/BaseDOM.html">BaseDOM</a></li>
                                <li><a href="../classes/BaseView.html">BaseView</a></li>
                                <li><a href="../classes/ColorUtils.html">ColorUtils</a></li>
                                <li><a href="../classes/Detections.html">Detections</a></li>
                                <li><a href="../classes/EventDispatcher.html">EventDispatcher</a></li>
                                <li><a href="../classes/NavigationLoader.html">NavigationLoader</a></li>
                                <li><a href="../classes/SpriteSheetAnimation.html">SpriteSheetAnimation</a></li>
                                <li><a href="../classes/StringUtils.html">StringUtils</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../../source/coffee/slikland/anim/BaseAnimation.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
# import slikland.anim.AnimationTicker

###*
BaseAnimation interface class for most frame / time based animation.&lt;br&gt;
Please do not instantiate this class. Use the extended classes.
@class BaseAnimation
@extends BaseDOM

###

class BaseAnimation extends BaseDOM

	###*
	Triggered when animation starts. Usually when {{#crossLink &quot;BaseAnimation/play:method&quot;}}{{/crossLink}} is called.
	@event PLAY
	###
	@PLAY: &#x27;animation_play&#x27;

	###*
	Triggered when animation stops. Usually when {{#crossLink &quot;BaseAnimation/stop:method&quot;}}{{/crossLink}} is called.
	@event STOP
	###
	@STOP: &#x27;animation_stop&#x27;

	###*
	Triggered when animation resumes. Usually when {{#crossLink &quot;BaseAnimation/resume:method&quot;}}{{/crossLink}} is called.
	@event RESUME
	###
	@RESUME: &#x27;animation_resume&#x27;

	###*
	Triggered when animation pauses. Usually when {{#crossLink &quot;BaseAnimation/pause:method&quot;}}{{/crossLink}} is called.
	@event PAUSE
	###
	@PAUSE: &#x27;animation_pause&#x27;

	###*
	Triggered when animation finishes.
	@event COMPLETE
	###
	@COMPLETE: &#x27;animation_complete&#x27;

	###*
	Triggered when animation reached the end and repeats.
	@event REPEAT
	###
	@REPEAT: &#x27;animation_repeat&#x27;

	###*
	Triggered when animation changes it&#x27;s frame.
	@event UPDATE
	###
	@UPDATE: &#x27;animation_update&#x27;

	_repeat: false
	_fps: 15

	#Inverted FPS value
	_iFps: 0

	_currentTime: 0
	_totalTime: 0
	_durationTime: 0
	_currentFrame: 0
	_totalFrames: 0
	_durationFrames: 0
	_currentLabel: null
	_animData: null
	_currentAnimData: null
	_labels: []

	constructor:()-&gt;
		if @constructor.name == &#x27;BaseAnimation&#x27;
			throw new Error(&#x27;Please extend me.&#x27;)
		super({element: &#x27;div&#x27;, className: &#x27;animation&#x27;})

	###*
	Return true if the animation was paused

	@attribute paused
	@type Boolean
	@readOnly
	###
	@get paused:()-&gt;
		return @_paused


	###*
	Define if the animation will repeat or not.&lt;br&gt;
	By default it&#x27;s set to false.&lt;br&gt;
	If the value is set to true, it will repeat infinitely.&lt;br&gt;
	This value can also be changed when calling the {{#crossLink &quot;BaseAnimation/play:method&quot;}}{{/crossLink}} method.

	@attribute repeat
	@default false
	@type Boolean | Number
	###
	@get repeat:()-&gt;
		return @_repeat

	@set repeat:(value)-&gt;
		@_repeat = value

	###*
	Frame rate of animation.
	@attribute fps
	@type Number
	###
	
	@get fps:()-&gt;
		return @_fps
	@set fps:(value)-&gt;
		if isNaN(value)
			throw new Error(&#x27;fps isNaN&#x27;)
		@_fps = value
		@_iFps = 1 / @_fps
		@_dirty = true

	###*
	Current time of the animation in seconds.
	If it&#x27;s playing a specific label, it refers to the portion of the label.
	
	@attribute currentTime
	@type Number
	###
	@get currentTime:()-&gt;
		return @_currentTime
	@set currentTime:(value)-&gt;
		if isNaN(value)
			throw new Error(&#x27;currentTime isNaN&#x27;)
		@_currentTime = value
		@_dirty = true

	###*
	Total time of the animation in seconds.
	If it&#x27;s playing a specific label, it refers to the portion of the label.
	
	@attribute totalTime
	@type Number
	@readOnly
	###
	@get totalTime:()-&gt;
		return @_totalTime

	###*
	Current frame number of the animation.
	If it&#x27;s playing a specific label, it refers to the portion of the label.
	
	@attribute currentFrame
	@type Number
	###
	
	@get currentFrame:()-&gt;
		return @_currentFrame
	@set currentFrame:(value)-&gt;
		if isNaN(value)
			throw new Error(&#x27;currentFrame isNaN&#x27;)
		@_currentFrame = value
		@_dirty = true

	###*
	Duration in frames of the animation.
	If it&#x27;s playing a specific label, it refers to the portion of the label.
	
	@attribute durationFrames
	@type Number
	@readOnly
	###
	
	@get durationFrames:()-&gt;
		return @_durationFrames

	###*
	Total number of frames of the animation.
	
	@attribute totalFrames
	@type Number
	@readOnly
	###
	
	@get totalFrames:()-&gt;
		return @_totalFrames

	###*
	The name of label currently playing.
	
	@attribute currentLabel
	@type String
	@readOnly
	###
	
	@get currentLabel:()-&gt;
		return @_currentLabel

	@set _dirty:(value)-&gt;
		if !value
			return
		clearTimeout(@_dirtyTimeout)
		@_dirtyTimeout = setTimeout(@_redraw, 0)

	@set _labelsDirty:(value)-&gt;
		if !value
			return
		clearTimeout(@_labelsDirtyTimeout)
		@_labelsDirtyTimeout = setTimeout(@_updateLabels, 0)

	###*
	Add a section of frames with a label name.
	@method addLabel
	@param {String} name Name of the label
	@param {Number} start Number of frame that the animation should start
	@param {Number} [end] Last frame of the section. If this parameter is not set, will get the next label&#x27;s &#x60;start&#x60; or the last frame of entire animation.
	###
	addLabel:(name, start, end = null)-&gt;
		@removeLabel(name)
		@_labels.push({name: name, start: start, end: end})
		@_labelsDirty = true

	###*
	Remove a label
	@method removeLabel
	@param {String} name Name of the label
	###
	removeLabel:(name)-&gt;
		i = @_labels.length
		while i-- &gt; 0
			if @_labels[i].name == name
				@_labels.splice(i, 1)
		@_labelsDirty = true

	_updateLabels:()=&gt;
		@_labels.sort(@_sortLabels)
		f0 = f1 = @_totalFrames - 1
		i = @_labels.length
		while i-- &gt; 0
			labelData = @_labels[i]
			if labelData.end is null
				labelData.duration = f0 - labelData.start
			else
				labelData.duration = labelData.end - labelData.start
			if labelData.start != f1
				f0 = f1
				f1 = labelData.start

		@_numLabels = @_labels.length
	_sortLabels:(a, b)=&gt;
		if a.start &lt; b.start
			return -1
		if a.start &gt; b.start
			return 1
		if a.end &gt; b.end
			return -1
		if a.end &lt; b.end
			return 1
		return 0

	###*
	Play the animation.&lt;br&gt;
	It receives a &#x60;data&#x60; object which is optional with some settings.
	@method play
	@param {Object} [data={}] Data with values explained below:
	Name |Type|Default|Description
	-----|----|:------|-----------
	delay|Number|0|Delay in seconds to start the animation
	{{#crossLink &quot;BaseAnimation/repeat:attribute&quot;}}{{/crossLink}}|Boolean&amp;nbsp;\|&amp;nbsp;Number|false|If the animation should repeat. If number is passed, will repeat the amount of number defined.
	label|String|null|The label of the animation to play. If nothing is passed, will play the entire animation.
	###
	play:(data = {})-&gt;
		@_paused = false
		@_repeat = data.repeat || false
		@_animData = @_getLabelData(data.label)
		@_durationFrames = @_animData.duration
		@_durationTime = @_durationFrames * @_iFps
		@_currentFrame = 0
		@_currentTime = 0
		AnimationTicker.add(@_update, {fps: @_fps, delay: data.delay || 0})
		@trigger(@constructor.PLAY)

	###*
	Resume the animation. If the {{#crossLink &quot;BaseAnimation/play:method&quot;}}{{/crossLink}} method was called with a label, it will resume the portion of the specified label
	@method resume
	###
	resume:()-&gt;
		if !@_animData
			throw new Error(&#x27;Resume can only be called after a pause.&#x27;)
		@_paused = false
		AnimationTicker.add(@_update, {fps: @_fps, initFrame: @_currentFrame})
		@trigger(@constructor.RESUME)

	###*
	Pause the animation.
	@method pause
	###
	pause:()-&gt;
		if !@_animData
			throw new Error(&#x27;Can\&#x27;t pause an animation that is not playing.&#x27;)
		@_paused = true
		AnimationTicker.remove(@_update)
		@trigger(@constructor.PAUSE)

	###*
	Stop the animation and goes to last frame.
	@method stop
	###
	stop:()-&gt;
		if !@_animData
			throw new Error(&#x27;Can\&#x27;t stop an animation that is not playing.&#x27;)
		@_paused = false
		AnimationTicker.remove(@_update)
		# @currentFrame = 0
		@trigger(@constructor.STOP)

	_getLabelData:(label = null)-&gt;
		data = {start: 0, end: @_totalFrames - 1, duration: @_totalFrames}
		if !@_numLabels?
			@_updateLabels()
		if label
			i = @_numLabels
			while i-- &gt; 0
				if @_labels[i].name == label
					data = @_labels[i]
					break
		return data

	_update:(data)=&gt;
		if !@_animData
			throw new Error(&#x27;Can\&#x27;t update without _animData&#x27;)
		f = data.frame
		nf = ((f % @_durationFrames) + @_durationFrames) % @_durationFrames
		if nf == @_currentFrame
			return

		@stackTrigger(@constructor.UPDATE)
		if f &gt;= @_durationFrames
			if @_repeat
				@stackTrigger(@constructor.REPEAT)
			else
				@stackTrigger(@constructor.COMPLETE)
				@stop()
				f = @_durationFrames - 1

		@_currentFrame = ((f % @_durationFrames) + @_durationFrames) % @_durationFrames
		@_currentTime = @_currentFrame * @_iFps
		@_dirty = true

	_redraw:()=&gt;
		throw new Error(&#x27;Method _redraw not overwritten.&#x27;)
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
