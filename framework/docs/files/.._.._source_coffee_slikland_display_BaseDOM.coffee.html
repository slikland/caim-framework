<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../../source/coffee/slikland/display/BaseDOM.coffee - Slikland Framework</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="http://slikland.com/media/images/logo_docs.png" title="Slikland Framework"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AnimationTicker.html">AnimationTicker</a></li>
                                <li><a href="../classes/ArrayUtils.html">ArrayUtils</a></li>
                                <li><a href="../classes/BaseAnimation.html">BaseAnimation</a></li>
                                <li><a href="../classes/BaseDOM.html">BaseDOM</a></li>
                                <li><a href="../classes/BaseNavigationController.html">BaseNavigationController</a></li>
                                <li><a href="../classes/BaseView.html">BaseView</a></li>
                                <li><a href="../classes/Caim.html">Caim</a></li>
                                <li><a href="../classes/ColorUtils.html">ColorUtils</a></li>
                                <li><a href="../classes/ConditionsValidation.html">ConditionsValidation</a></li>
                                <li><a href="../classes/Debug.html">Debug</a></li>
                                <li><a href="../classes/Detections.html">Detections</a></li>
                                <li><a href="../classes/EventDispatcher.html">EventDispatcher</a></li>
                                <li><a href="../classes/MetaController.html">MetaController</a></li>
                                <li><a href="../classes/Navigation.html">Navigation</a></li>
                                <li><a href="../classes/NavigationContainer.html">NavigationContainer</a></li>
                                <li><a href="../classes/NavigationLoader.html">NavigationLoader</a></li>
                                <li><a href="../classes/NavigationRouter.html">NavigationRouter</a></li>
                                <li><a href="../classes/PreloadFiles.html">PreloadFiles</a></li>
                                <li><a href="../classes/Prototypes.html">Prototypes</a></li>
                                <li><a href="../classes/SpriteSheetAnimation.html">SpriteSheetAnimation</a></li>
                                <li><a href="../classes/StringUtils.html">StringUtils</a></li>
                                <li><a href="../classes/ViewsData.html">ViewsData</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../../source/coffee/slikland/display/BaseDOM.coffee</h1>

<div class="file">
    <pre class="code prettyprint linenums">
#import slikland.utils.Prototypes
#import slikland.event.EventDispatcher

#
# Helper for adding BaseDOM into any DOM element
#
# TODO: FIX IE8+
#

unless &quot;findParents&quot; of Node::
	Node::findParents = (query) -&gt;
		if @parentNode? and @parentNode isnt document
			if @parentNode.matches(query)
				return @parentNode
			else
				return @parentNode.findParents(query)
		return null

unless &quot;contains&quot; of Node::
	Node::contains = (node)-&gt;
		for v in @childNodes
			if v == (node.element || node)
				return true
				break
		return false
else
	unless &quot;__contains__&quot; of Node::
		Node::__contains__ = Node::contains
		Node::contains = (node)-&gt;
			return @__contains__(node.element || node)

unless &quot;__appendChild__&quot; of Node::
	Node::__appendChild__ = Node::appendChild
	Node::appendChild = (node) -&gt;
		el = node.element || node
		@__appendChild__(el) if el?
		if node instanceof BaseDOM
			node.parent = @__instance__ || @
		return node

unless &quot;__removeChild__&quot; of Node::
	Node::__removeChild__ = Node::removeChild
	Node::removeChild = (node) -&gt;
		el = node.element || node
		@__removeChild__(el) if el?
		if node instanceof BaseDOM
			node.parent = null
		return node

unless &quot;__replaceChild__&quot; of Node::
	Node::__replaceChild__ = Node::replaceChild
	Node::replaceChild = (newNode, oldNode) -&gt;
		el1 = newNode
		el2 = oldNode

		if newNode instanceof BaseDOM
			el1 = newNode.element
		if oldNode instanceof BaseDOM
			el2 = oldNode.element

		node = Node::__replaceChild__.call(@, el1, el2) if el1? and el2?

		if newNode instanceof BaseDOM
			newNode.parent = @__instance__ || @
		if oldNode instanceof BaseDOM
			oldNode.parent = null
		return node

#
# TODO: FIX IE8+
# Node.get({instance: ()-&gt; return @__instance__})

# BaseDOM: SlikLand DOM
###*
Base DOM manipulation class
@class BaseDOM
###

class BaseDOM extends EventDispatcher

	@ADDED_TO_DOCUMENT: &#x27;added_to_document&#x27;
	@REMOVED_FROM_DOCUMENT: &#x27;removed_from_document&#x27;

	@isElement:(p_target)-&gt;
		return Element.isElement(p_target)

	#
	# Deprecated params: constructor:(element = &#x27;div&#x27;, className = null, namespace = null)-&gt;
	#
	constructor:(p_options...)-&gt;
		super
		#
		# Default params:
		#
		element = &#x27;div&#x27;
		className = null
		namespace = null

		if typeof(p_options[0]) == &#x27;string&#x27; || p_options[0] instanceof Element
			element = p_options[0]
		else
			i = p_options.length
			while i--
				option = p_options[i]
				if option.element? then element = option.element
				if option.className? then className = option.className
				if option.namespace? then namespace = option.namespace

		if typeof(element) == &#x27;string&#x27;
			if namespace
				@_namespace = namespace
				@_element = document.createElementNS(@_namespace, element)
			else
				@_element = document.createElement(element)
		else
			@_element = element

		if @element.parentElement? and !@_parent?
			@parent = @element.parentElement.__instance__ || @element.parentElement

		if className
			@addClass(className)

		if MutationObserver?
			@_observer = new MutationObserver(@_mutations)
			@_observer.observe(@element, { childList: true })
		else
			@element.on &#x27;DOMNodeInsertedIntoDocument&#x27;, @_addedToDOM
			@element.on &#x27;DOMNodeRemovedFromDocument&#x27;, @_removedFromDOM

		@element.__instance__ = @

	##------------------------------------------------------------------------------
	##
	##	GETTER / SETTER
	##
	##------------------------------------------------------------------------------

	##--------------------------------------
	##	Base element getter. Read-only
	##--------------------------------------
	@get element: ()-&gt;
		return @_element

	##--------------------------------------
	##	Base namespace getter. Read-only
	##--------------------------------------
	@get namespace: ()-&gt;
		return @_namespace

	##--------------------------------------
	##	Childnodes array
	##--------------------------------------
	@get childNodes:()-&gt;
		return @element.childNodes

	##--------------------------------------
	##	Instance bounds. Only getters.
	##	If changing size, use CSS.
	##--------------------------------------
	@get width:()-&gt;
		return @getBounds().width

	@get height:()-&gt;
		return @getBounds().height

	@get outerWidth:()-&gt;
		w = @width
		space = @numberStyle(&#x27;margin-left&#x27;) + @numberStyle(&#x27;margin-right&#x27;)
		return w + space

	@get outerHeight:()-&gt;
		h = @height
		space = @numberStyle(&#x27;margin-top&#x27;) + @numberStyle(&#x27;margin-bottom&#x27;)
		return h + space

	@get left:()-&gt;
		return @getBounds().left
	@get top:()-&gt;
		return @getBounds().top

	@get x:()-&gt;
		return @getBounds().left
	@get y:()-&gt;
		return @getBounds().top

	@get windowScroll:()-&gt;
		supportPageOffset = window.pageXOffset isnt undefined
		isCSS1Compat = ((document.compatMode || &quot;&quot;) is &quot;CSS1Compat&quot;)

		x = if supportPageOffset then window.pageXOffset else if isCSS1Compat then document.documentElement.scrollLeft else document.body.scrollLeft
		y = if supportPageOffset then window.pageYOffset else if isCSS1Compat then document.documentElement.scrollTop else document.body.scrollTop

		return {
			x: x
			y: y
		}

	@get scrollPosition:()-&gt;
		return {y:@element.offsetTop, x:@element.offsetLeft}

	@set scrollY:(p_value)-&gt;
		@element.scrollTop = p_value

	@get scrollY:()-&gt;
		return @element.scrollTop

	@set scrollX:(p_value)-&gt;
		@element.scrollLeft = p_value

	@get scrollX:()-&gt;
		return @element.scrollLeft

	@get attributes:()-&gt;
		return @element.attributes

	##--------------------------------------
	##	CSS Class Name
	##--------------------------------------
	@get className:()-&gt;
		return @element.className

	@set className:(value)-&gt;
		@element.className = value.trim()

	@get text:()-&gt;
		return @element.textContent

	@set text:(value)-&gt;
		@element.textContent = value

	##--------------------------------------
	##	InnerHTML
	##--------------------------------------
	@get html:()-&gt;
		return @element.innerHTML
	@set html:(value)-&gt;
		@element.innerHTML = value

	##--------------------------------------
	##	Parent instance. Can be HTMLElement
	##--------------------------------------
	@get parent: ()-&gt;
		return @_parent

	@set parent: (value = null)-&gt;
		if value?
			if !(value instanceof BaseDOM) &amp;&amp; !(value instanceof Node)
				throw new Error(&#x27;Parent instance is not either Node or BaseDOM&#x27;)
			@_parent = value
		else
			@_parent = null
			@_observer?.disconnect()
			@_observer = null
			delete @_observer

	@get isAttached:(p_container = null)-&gt;
		if typeof (p_container.contains) is &#x27;function&#x27;
			return p_container.contains(@element)
		return document.contains?(@element) || document.body.contains(@element)

	##--------------------------------------
	##	DOM Manipulation
	##--------------------------------------
	appendChild:(child)-&gt;
		@appendChildAt(child)

	appendChildAt:(child, index = -1)-&gt;
		el = child
		if child instanceof BaseDOM
			el = child.element
		if index == -1 || index &gt;= @childNodes.length
			@element.appendChild(el)
		else
			@element.insertBefore(el, @childNodes[index])
		if child instanceof BaseDOM
			child.parent = @__instance__ || @
		return child

	replaceChild:(replaceElement, oldElement)-&gt;
		el1 = replaceElement
		el2 = oldElement
		if replaceElement instanceof BaseDOM
			el1 = replaceElement.element
		if oldElement instanceof BaseDOM
			el2 = oldElement.element
		@element.replaceChild el1, el2
		if replaceElement instanceof BaseDOM
			replaceElement.parent = @__instance__ || @
		if oldElement instanceof BaseDOM
			oldElement.parent = null
		return replaceElement

	remove:()-&gt;
		@parent?.removeChild?(@)

	removeChild:(child, destroy = false)-&gt;
		return if !child
		if child instanceof BaseDOM
			if !!destroy
				child.removeAll(true)
				child.destroy()
				return child
		if @contains(child)
			return @element.removeChild(child)

	removeChildAt:(index = -1)-&gt;
		if index &lt; @childNodes.length
			return @removeChild(@childNodes[i])

	removeAll:(destroy = false)-&gt;
		childs = @childNodes
		i = childs.length
		while i-- &gt; 0
			domInstance = childs[i].__instance__
			child = domInstance || childs[i]
			if child?
				@removeChild(child, !!domInstance and !!destroy)

	contains:(child)-&gt;
		return @element.contains(child)

	##--------------------------------------
	##	Check if the instance matches a query selector
	##--------------------------------------
	matches:(query)-&gt;
		return @element.matches(query)

	##--------------------------------------
	##	Find parent nodes for a matching query selector
	findParents:(query)-&gt;
		return @element.findParents(query)

	##--------------------------------------
	##	Query selector
	##	@onlyInstances: If return only BaseDOM instances
	##--------------------------------------
	find:(query, onlyInstances = false)-&gt;
		element = @element.querySelector(query)
		if onlyInstances
			return element?.__instance__
		else
			return element

	##--------------------------------------
	##	Query selector find all
	##	@onlyInstances: If return only BaseDOM instances
	##--------------------------------------
	findAll:(query, onlyInstances = false)-&gt;
		elements = @element.querySelectorAll(query)
		if onlyInstances
			els = []
			i = -1
			l = elements.length
			p = 0
			while ++i &lt; l
				if elements[i].__instance__
					els[p++] = elements[i].__instance__
			elements = els
		return elements

	##--------------------------------------
	##	Set / Get element attribute
	##	Accepts object:
	##	@example:
	##	attr({id: 1, name: 2})
	##--------------------------------------

	removeAttr:(name, namespace = null)-&gt;
		if namespace is true
			namespace = @namespace

		methodArgs = [name]
		methodSuffix = &quot;Attribute&quot;
		if namespace?
			methodSuffix += &quot;NS&quot;
			methodArgs.unshift(namespace)

		if typeof(name) == &#x27;string&#x27;
			return @element?[&quot;remove#{methodSuffix}&quot;].apply(@element, methodArgs)
		else if Array.isArray(name)
			for key in name
				methodArgs.splice(-1, 1, key)
				@element?[&quot;remove#{methodSuffix}&quot;].apply(@element, methodArgs)

	attr:(name, value = null, namespace = null)-&gt;
		if typeof(name) == &#x27;string&#x27;
			return @_attr(name, value, namespace)
		else if typeof(name) == &#x27;object&#x27;
			for k, v of name
				@_attr(k, v, namespace)

	_attr:(name, value = null, namespace = null)-&gt;
		if namespace is true
			namespace = @namespace

		methodArgs = [name, value]
		methodSuffix = &quot;Attribute&quot;
		if namespace?
			methodSuffix += &quot;NS&quot;
			methodArgs.unshift(namespace)

		if value?
			@element?[&quot;set#{methodSuffix}&quot;].apply(@element, methodArgs)
		return @element?[&quot;get#{methodSuffix}&quot;].apply(@element, methodArgs)

	##--------------------------------------
	##	Set / Get element CSS
	##	Accepts object:
	##	@example:
	##	css({color: 1, width: 2})
	##--------------------------------------
	_css:(name, value = null, p_number = false)-&gt;
		if value isnt null
			@element.style[name] = value
		return if p_number then @numberStyle(name) else @style(name)

	css:(name, value = null, p_number = false)-&gt;
		if typeof(name) == &#x27;string&#x27;
			return @_css(name, value, p_number)
		else if typeof(name) == &#x27;object&#x27;
			for k, v of name
				@_css(k, v, p_number)

	##--------------------------------------
	##	Get element ComputedStyle
	##	@example:
	##	style(&#x27;minHeight&#x27;)
	##--------------------------------------
	style:(styleProp = null, el = @element)-&gt;
		el = el.element if el instanceof BaseDOM
		source = null
		if window.getComputedStyle?
			source = window.getComputedStyle(el)
		else if el.currentStyle
			source = el.currentStyle
		else if document.defaultView and document.defaultView.getComputedStyle
			source = document.defaultView.getComputedStyle(el, null)
		else
			source = @element.style
		return if styleProp? then source[styleProp] else source

	numberStyle:(styleProp = null, el = @element)-&gt;
		if styleProp?
			return parseFloat(@style(styleProp, el) || &#x27;0&#x27;)
		else
			source = @style(null, el)
		result = {}
		for k, v of source
			if isNaN(parseInt(k))
				result[k] = v
				if !isNaN(parseFloat(v))
					result[k] = parseFloat(v)
		return result

	##--------------------------------------
	##	CSS Class name manipulation
	##--------------------------------------
	addClass:(className)-&gt;
		if typeof(className) is &#x27;string&#x27;
			className = className.replace(/\s+/ig, &#x27; &#x27;).split(&#x27; &#x27;)
		else if !Array.isArray(className)
			return

		if @element.classList?
			className = if !Array.isArray(className) then [className] else className
			className.forEach(action = (value)-&gt;
				@classList.add(value)
			, @element)
			action = null
			return @className

		classNames = @className.replace(/\s+/ig, &#x27; &#x27;).split(&#x27; &#x27;)
		p = classNames.length
		i = className.length
		while i-- &gt; 0
			if classNames.indexOf(className[i]) &gt;= 0
				continue
			classNames[p++] = className[i]
		@className = classNames.join(&#x27; &#x27;)


	removeClass:(className)-&gt;
		if typeof(className) is &#x27;string&#x27;
			className = className.replace(/\s+/ig, &#x27; &#x27;).split(&#x27; &#x27;)
		else if !Array.isArray(className)
			return

		if @element.classList?
			className = if !Array.isArray(className) then [className] else className
			className.forEach(action = (value)-&gt;
				@classList.remove(value)
			, @element)
			action = null
			return @className

		classNames = @className.replace(/\s+/ig, &#x27; &#x27;).split(&#x27; &#x27;)
		i = className.length
		while i-- &gt; 0
			if (p = classNames.indexOf(className[i])) &gt;= 0
				classNames.splice(p, 1)
		@className = classNames.join(&#x27; &#x27;)

	toggleClass:(className, toggle = null)-&gt;
		if toggle isnt null
			if toggle
				@addClass(className)
			else
				@removeClass(className)
			return
		if typeof(className) is &#x27;string&#x27;
			className = className.replace(/\s+/ig, &#x27; &#x27;).split(&#x27; &#x27;)
		else if typeof(className) isnt &#x27;Array&#x27;
			return
		i = className.length
		while i-- &gt; 0
			if @hasClass(className[i])
				@removeClass(className[i])
			else
				@addClass(className[i])

	hasClass:(className)-&gt;
		if typeof(className) is &#x27;string&#x27;
			className = className.replace(/\s+/ig, &#x27; &#x27;).split(&#x27; &#x27;)
		else if typeof(className) isnt &#x27;Array&#x27;
			return

		classNames = @className.replace(/\s+/ig, &#x27; &#x27;).split(&#x27; &#x27;)
		i = className.length

		hasClass = true

		while i-- &gt; 0
			hasClass &amp;= (classNames.indexOf(className[i]) &gt;= 0)
		return hasClass

	_mutations:(mutations)=&gt;
		i = mutations.length
		while i--
			added = 0
			nodes = mutations[i].addedNodes
			length = mutations[i].addedNodes.length
			while length--
				nodes[added].__instance__?._addedToDOM({target:nodes[added]})
				added++

			removed = 0
			length = mutations[i].removedNodes.length
			nodes = mutations[i].removedNodes
			while length--
				nodes[removed].__instance__?._removedFromDOM({target:nodes[removed]})
				removed++
		undefined

	_addedToDOM:(evt)=&gt;
		@trigger BaseDOM.ADDED_TO_DOCUMENT, @_parent
		@added?()

	_removedFromDOM:(evt)=&gt;
		@trigger BaseDOM.REMOVED_FROM_DOCUMENT, @_parent
		@removed?()

	##--------------------------------------
	##	Get elements bounds as rectangle.
	##	{top, left, bottom, right, width, height}
	##--------------------------------------
	getBounds:(target = null)-&gt;
		boundsObj = {}
		bounds = @element.getBoundingClientRect()
		for k, v of bounds
			boundsObj[k] = v
		if target
			if (target instanceof BaseDOM)
				tbounds = target.getBounds()
			else if (target instanceof HTMLElement)
				tbounds = target.getBoundingClientRect()
		if tbounds
			boundsObj.top -= tbounds.top
			boundsObj.left -= tbounds.left
			boundsObj.bottom -= tbounds.top
			boundsObj.right -= tbounds.left
		boundsObj.width = boundsObj.right - boundsObj.left
		boundsObj.height = boundsObj.bottom - boundsObj.top

		return boundsObj

	destroy:()-&gt;
		@element.off &#x27;DOMNodeInsertedIntoDocument&#x27;, @_addedToDOM
		@element.off &#x27;DOMNodeRemovedIntoDocument&#x27;, @_removedFromDOM
		@off?()
		@removeAll?(true)
		@remove?()
		@_observer?.disconnect()
		@_observer = null
		@_namespace = null
		@_parent = null
		@_element.__instance__ = null
		delete @_observer
		delete @_namespace
		delete @_parent
		delete @_element.__instance__
		undefined

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
